<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>Phosphor: Phosphor Architecture</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Phosphor
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('md_docs_Architecture.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Phosphor Architecture </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h2>Frontend</h2>
<p>The frontend consists of two main interfaces:</p>
<ul>
<li>Instrumentation Macros</li>
<li>TraceLog / TraceLogConfig / TraceConfig</li>
</ul>
<h3>Instrumentation Macros</h3>
<p>The instrumentation macros are basically wrappers around the TraceLog::logEvent member functions. There are also some additional utilities, such as the scoped macros.</p>
<h3>TraceLog</h3>
<p>The TraceLog is the primary interface used for interacting with Phosphor externally. It is used by the instrumentation macros for actually logging events and also used directly by end users for configuration etc.</p>
<p>The TraceLog encapsulates most of the logic for actually managing tracing tracing events and tying all the parts of the system together.</p>
<h4>TraceLogConfig</h4>
<p>The TraceLogConfig class is used to perform one-time configuration of a TraceLog and consists of configuration that can only performed once.</p>
<h4>TraceConfig</h4>
<p>The TraceConfig class is used to perform per-trace configuration of a TraceLog and is passed directly to the TraceLog::start member function.</p>
<h2>Backend</h2>
<h3>TraceEvent</h3>
<p>The TraceEvent class represents a singular event which contains a name, category, timestamp (Which is accurate/meaningful relative to other events) and optional arguments along with the type for those arguments.</p>
<h3>TraceChunk</h3>
<p>A TraceChunk is conceptually a collection of TraceEvents and contains 1 or more pages worth of TraceEvents.</p>
<h3>TraceBuffer</h3>
<p>The TraceBuffer is a collection of TraceChunks. It loans TraceChunks out to ChunkTenants.</p>
<h3>ChunkTenant</h3>
<p>A ChunkTenant is conceptually an object which borrows a TraceChunk from a TraceBuffer. A ChunkTenant can either be allocated per-thread (In the event that threads have been registered appropriately) or can be shared using a pool of ChunkTenants distributed by thread id. A ChunkTenant has two main parts</p>
<ul>
<li>A pointer to the currently borrowed chunk (Or nullptr if not currently borrowing one).</li>
<li>A chunk sentinel</li>
</ul>
<h4>Chunk <code>Sentinel</code></h4>
<p>The sentinel is used to guard access to a Chunk. It is principally a tri-state lock:</p>
<ul>
<li>Open: the chunk is currently unlocked and the current pointer is either null or it is safe to use</li>
<li>Busy: the chunk is currently locked and the pointer is either safe to use or being made safe by the person who locked the sentinel.</li>
<li>Closed: the chunk is currently unlocked but the current pointer is not safe to use. A TraceLog transitions a sentinel into this third state to indicate that the next user of the ChunkTenant should replace or at least nullify the chunk.</li>
</ul>
<p>The TraceLog will transition the chunk sentinel to closed when the trace buffer gets full or when tracing is stopped, this is usually because the trace buffer ownership will be transferred away and the chunk 'loans' need to be revoked. This transition can only be done when the sentinel is open and will block until it is in this state.</p>
<p>A thread using a ChunkTenant will try to transition its sentinel to busy when they need to log an event and back to open when it's done. It will fail to do this if the sentinel is currently closed. In this event the chunk tenant will transition the sentinel to busy in another way and be aware that it needs to replace the chunk it had before. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.11 </li>
  </ul>
</div>
</body>
</html>
